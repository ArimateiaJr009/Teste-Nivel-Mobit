#!/bin/bash

#LIMITES PRE ESTABELECIDOS PARA O SCRIPT, CASO TENHA NECESSIDADE MODIFICAR TAIS VALORES
LIMIT_DISK=80
LIMIT_RAM=10
LIMIT_TEMPERATURE=70

#VARIAVEL PARA RECEBER A DATA E HORA ATUAL
CURRENT_DATE=$(date +'%Y-%m-%d %H:%M')


#VARIAVEL DE LOG COMO DEFINIDO PELA QUESTAO
LOG="/var/log/resource_log.log"
LOG_MEMORY="/var/log/memory_usage.log"
LOG_TEMPERATURA="/var/log/temperature_core.log"


#PARA VERIFICAR INFORMACOES SOBRE CONSUMO DE PARTICOES UTILIZA-SE O COMANDO
# df (disk free) O PARAMETRO -h NOS ORIENTA SOBRE O TAMANHO DAS IMPRESSOES 
# EM POTENCIA JA O COMANDO awk MANIPULA O TEXTO DE COMO QUE GARIPAMOS O
# QUE SERVE E DISPENSAMOS OS EXTRAS


utiliza_disco=$(df -h | awk '{print $5}'| awk -F'%' '{print $1}')
for disco in $utiliza_disco; do #AQUI FAZ A VARREDURA  
#echo $disco
if [[ $disco -gt $LIMIT_DISK ]] ; then 
dev=$(df -h | awk '{print $1}') #AQUI CRIA-SE O LOG PARA ALERTA E EMAIL DE ALERTA
echo "ALERT!! DISK USED ABOVE THRESHOLD FOR $dev IN $CURRENT_DATE" >> $LOG | echo "ALERT!! DISK USAGE ABOVE THRESHOULD FOR $dev in $current_date "| mail -s "ALERT FULL DISK" juniorcs09@gmail.com
#else
#echo "f"
fi
done

#PARA VERIFICAR MEMORIA UTILIZAREMOS O COMANDO FREE
MEMORY_USAGE=$(free -m | awk 'NR==2{print $3*100/$2}') #AQUI CALCULAMOS MEMORIA
AUX=${MEMORY_USAGE%.*} #AQUI CONVERTEMOS PARA INTEIRO DEVIDO A INCAPACIDADE DO SHELL DE FAZER CALCULO COM FLOAT
if [ $AUX -gt $LIMIT_RAM  ] ; then
echo "ALERT!! MEMORY USAGE ABOVE THRESHOLD IN $CURRENT_DATE" >> $LOG_MEMORY | echo "ALERT!! MEMORY USAGE ABOVE THRESHOULD IN $CURRENT_DATE" | mail -s "ALERT MEMORY USAGE" juniorcs09@gmail.com 
fi

#PARA VERIFICAR AS TEMPERATURAS DE CORES ESCOLHEMOS O PACOTE LS SENSOR
TEMP_CORE=$(sensors | grep Core)
for temp in $TEMP_CORE; do
if [[temp -gt $LIMITE_TEMPERATURE]] ; then
echo "ALERT!! TEMPERATURE OF CORE ABOVE THRESHOLD IN $CURRENT_DATE" >> $LOG_TEMPERATURE | echo "ALERT TEMPERATURE OF CORE ABOVE THRESHOULD IN $CURRENT_DATE" | mail -s "ALERT CORE TEMPERATURE" juniorcs09@gmail.com


#OUTRO MODO DE VERIFICAR TEMPERATURA DO NUCLEOS
TEMPERATURE_CORE=$(cat /sys/class/thermal/thermal_zone*/temp)
#ESSE PATH DEPENDO DO SISTEMA
for temp in  $TEMPERATURE_CORE; do
temp=$(echo "$temp / 1000"| bc )
if [[$temp -gt $LIMITE_TEMPERATURE ]]; then
echo "ALERT!! TEMPERATURE OD CORE ABOVE THRESHOLD IN $CURRENT_DATA" >> $LOG_TEMP | echo "ALERT!! TEMPERATURE OF CORE ABOVE THRESHOLD IN $CURRENT_DATE" | mail -s "ALERT CORE TEMPERATURE" juniorcs09@gmail.com
